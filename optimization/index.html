<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>优化 | ModyQyW&#39;s Site</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="alternate" type="application/atom+xml" href="https://modyqyw.top/atom.xml" title=" Atom Feed">
    <link rel="alternate" type="application/json" href="https://modyqyw.top/feed.json" title=" JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="https://modyqyw.top/rss.xml" title=" RSS Feed">
    <link rel="icon" href="/favicon.ico">
    <link rel="icon" href="/icons/w48.png" type="image/png" sizes="48x48">
    <link rel="icon" href="/icons/w72.png" type="image/png" sizes="72x72">
    <link rel="icon" href="/icons/w96.png" type="image/png" sizes="96x96">
    <link rel="icon" href="/icons/w144.png" type="image/png" sizes="144x144">
    <link rel="icon" href="/icons/w168.png" type="image/png" sizes="168x168">
    <link rel="icon" href="/icons/w192.png" type="image/png" sizes="192x192">
    <link rel="icon" href="/icons/w256.png" type="image/png" sizes="256x256">
    <link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials">
    <link rel="apple-touch-icon" href="/icons/w48.png">
    <meta name="description" content="基于 vuepress 和 vuepress-theme-hope 打造的个人网站，如有问题请尝试强制刷新。">
    <meta property="og:url" content="/optimization/">
    <meta property="og:title" content="优化">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="zh-CN">
    <meta name="twitter:card" content="summary_large_image">
    <meta property="article:author" content="ModyQyW <wurui7@mail3.sysu.edu.cn>">
    <meta name="theme-color" content="#46bd87">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/w48.png">
    <meta name="msapplication-TileColor" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="preload" href="/assets/css/0.styles.aae05d4a.css" as="style"><link rel="preload" href="/assets/js/app.97090625.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.2575cae3.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.98c9c1a5.js" as="script"><link rel="preload" href="/assets/js/page-优化.4906bffb.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.ec478e91.js" as="script"><link rel="prefetch" href="/assets/js/19.97cb309d.js"><link rel="prefetch" href="/assets/js/layout-Blog.436e05ac.js"><link rel="prefetch" href="/assets/js/layout-Layout.54347a9b.js"><link rel="prefetch" href="/assets/js/layout-NotFound.e98815ff.js"><link rel="prefetch" href="/assets/js/layout-Slide.144d7ab1.js"><link rel="prefetch" href="/assets/js/page-Home.002f9c71.js"><link rel="prefetch" href="/assets/js/page-Webpack4.88b01faa.js"><link rel="prefetch" href="/assets/js/page-关于.a4cdc67a.js"><link rel="prefetch" href="/assets/js/page-学习路径.bca4e2aa.js"><link rel="prefetch" href="/assets/js/page-安全.c44b341e.js"><link rel="prefetch" href="/assets/js/page-开发.a8ee4af1.js"><link rel="prefetch" href="/assets/js/page-杂谈.98b98957.js"><link rel="prefetch" href="/assets/js/page-环境配置.85f14af6.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.eb4db7e8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.aae05d4a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/" class="home-link router-link-active"></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">主题色:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">主题模式:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link router-link-active"><!---->
  首页
</a></div><div class="nav-item"><a href="/roadmap/" class="nav-link"><!---->
  学习路径
</a></div><div class="nav-item"><a href="/environment/" class="nav-link"><!---->
  环境配置
</a></div><div class="nav-item"><a href="/development/" class="nav-link"><!---->
  开发
</a></div><div class="nav-item"><a href="/optimization/" aria-current="page" class="nav-link router-link-exact-active router-link-active active"><!---->
  优化
</a></div><div class="nav-item"><a href="/safety/" class="nav-link"><!---->
  安全
</a></div><div class="nav-item"><a href="/webpack4/" class="nav-link"><!---->
  Webpack4
</a></div><div class="nav-item"><a href="/about/" class="nav-link"><!---->
  关于
</a></div></nav> <!----> <a rel="noopener noreferrer" href="https://github.com/ModyQyW/modyqyw.github.io" target="_blank" class="repo-link can-hide">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!----> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/" class="nav-link router-link-active"><!---->
  首页
</a></div><div class="nav-item"><a href="/roadmap/" class="nav-link"><!---->
  学习路径
</a></div><div class="nav-item"><a href="/environment/" class="nav-link"><!---->
  环境配置
</a></div><div class="nav-item"><a href="/development/" class="nav-link"><!---->
  开发
</a></div><div class="nav-item"><a href="/optimization/" aria-current="page" class="nav-link router-link-exact-active router-link-active active"><!---->
  优化
</a></div><div class="nav-item"><a href="/safety/" class="nav-link"><!---->
  安全
</a></div><div class="nav-item"><a href="/webpack4/" class="nav-link"><!---->
  Webpack4
</a></div><div class="nav-item"><a href="/about/" class="nav-link"><!---->
  关于
</a></div> <a rel="noopener noreferrer" href="https://github.com/ModyQyW/modyqyw.github.io" target="_blank" class="repo-link">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><!----> <span class="title">优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/optimization/#说明" class="sidebar-link">说明</a></li><li><a href="/optimization/#处理条件分支-避免代码堆叠" class="sidebar-link">处理条件分支，避免代码堆叠</a></li><li><a href="/optimization/#使用事件委托减少事件绑定" class="sidebar-link">使用事件委托减少事件绑定</a></li><li><a href="/optimization/#留意局部性-避免性能劣化" class="sidebar-link">留意局部性，避免性能劣化</a></li><li><a href="/optimization/#克制地操作-dom-减少重新渲染" class="sidebar-link">克制地操作 DOM，减少重新渲染</a></li><li><a href="/optimization/#鼓励更新-减少不必要兼容" class="sidebar-link">鼓励更新，减少不必要兼容</a></li><li><a href="/optimization/#确定标签的位置-避免解析阻塞" class="sidebar-link">确定标签的位置，避免解析阻塞</a></li><li><a href="/optimization/#合理构建-减少请求的时间" class="sidebar-link">合理构建，减少请求的时间</a></li><li><a href="/optimization/#在合适的时候做合适的重构" class="sidebar-link">在合适的时候做合适的重构</a></li><li><a href="/optimization/#使用-lighthouse-辅助分析" class="sidebar-link">使用 LightHouse 辅助分析</a></li><li><a href="/optimization/#手动优化-vue" class="sidebar-link">手动优化 vue</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/optimization/#函数式组件" class="sidebar-link heading3">函数式组件</a></li><li class="sidebar-sub-header"><a href="/optimization/#改善-seo" class="sidebar-link heading3">改善 SEO</a></li><li class="sidebar-sub-header"><a href="/optimization/#异步加载非首页路由" class="sidebar-link heading3">异步加载非首页路由</a></li><li class="sidebar-sub-header"><a href="/optimization/#合理使用-vuex" class="sidebar-link heading3">合理使用 vuex</a></li></ul></li><li><a href="/optimization/#手动优化-react" class="sidebar-link">手动优化 react</a></li><li><a href="/optimization/#参考" class="sidebar-link">参考</a></li><li><a href="/optimization/#致谢" class="sidebar-link">致谢</a></li></ul></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb disable"><!----></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">优化</span></h1> <div class="page-info"><!----> <!----><!----><span aria-label="写作日期📅" data-balloon-pos="down" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2021-7-5</span></span><!----><!----><span aria-label="阅读时间⌛" data-balloon-pos="down" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>大约 24 分钟</span> <meta property="timeRequired" content="PT24M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/optimization/#说明" class="anchor-link heading2"><div>说明</div></a></li><li class="anchor"><a href="/optimization/#处理条件分支-避免代码堆叠" class="anchor-link heading2"><div>处理条件分支，避免代码堆叠</div></a></li><li class="anchor"><a href="/optimization/#使用事件委托减少事件绑定" class="anchor-link heading2"><div>使用事件委托减少事件绑定</div></a></li><li class="anchor"><a href="/optimization/#留意局部性-避免性能劣化" class="anchor-link heading2"><div>留意局部性，避免性能劣化</div></a></li><li class="anchor"><a href="/optimization/#克制地操作-dom-减少重新渲染" class="anchor-link heading2"><div>克制地操作 DOM，减少重新渲染</div></a></li><li class="anchor"><a href="/optimization/#鼓励更新-减少不必要兼容" class="anchor-link heading2"><div>鼓励更新，减少不必要兼容</div></a></li><li class="anchor"><a href="/optimization/#确定标签的位置-避免解析阻塞" class="anchor-link heading2"><div>确定标签的位置，避免解析阻塞</div></a></li><li class="anchor"><a href="/optimization/#合理构建-减少请求的时间" class="anchor-link heading2"><div>合理构建，减少请求的时间</div></a></li><li class="anchor"><a href="/optimization/#在合适的时候做合适的重构" class="anchor-link heading2"><div>在合适的时候做合适的重构</div></a></li><li class="anchor"><a href="/optimization/#使用-lighthouse-辅助分析" class="anchor-link heading2"><div>使用 LightHouse 辅助分析</div></a></li><li class="anchor"><a href="/optimization/#手动优化-vue" class="anchor-link heading2"><div>手动优化 vue</div></a></li><li class="anchor"><a href="/optimization/#函数式组件" class="anchor-link heading3"><div>函数式组件</div></a></li><li class="anchor"><a href="/optimization/#改善-seo" class="anchor-link heading3"><div>改善 SEO</div></a></li><li class="anchor"><a href="/optimization/#异步加载非首页路由" class="anchor-link heading3"><div>异步加载非首页路由</div></a></li><li class="anchor"><a href="/optimization/#合理使用-vuex" class="anchor-link heading3"><div>合理使用 vuex</div></a></li><li class="anchor"><a href="/optimization/#手动优化-react" class="anchor-link heading2"><div>手动优化 react</div></a></li><li class="anchor"><a href="/optimization/#参考" class="anchor-link heading2"><div>参考</div></a></li><li class="anchor"><a href="/optimization/#致谢" class="anchor-link heading2"><div>致谢</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h1 id="优化"><a href="#优化" class="header-anchor">#</a> 优化</h1> <h2 id="说明"><a href="#说明" class="header-anchor">#</a> 说明</h2> <ul><li>形式：尽量口语化的笔记和示例。</li> <li>适用：对 <code>vue</code> 和 <code>react</code> 底层，浏览器底层，js 引擎有基本了解，想要了解前端优化的开发者。</li> <li>目标：了解前端项目的可用优化，包括开发、编译和运行，这些优化一般需要手动处理，而不包含在各类 Linter 规则又或是官方文档说明里面。</li> <li>状态：目前处于完善中状态，可能会有遗漏、错误、不完美，但已经可以正常阅读。如果你发现了错误，请在评论里告诉我，谢谢。</li></ul> <h2 id="处理条件分支-避免代码堆叠"><a href="#处理条件分支-避免代码堆叠" class="header-anchor">#</a> 处理条件分支，避免代码堆叠</h2> <p>假定现在需要实现一个方法，接收的参数是数字，返回的参数是颜色值字符串。传入 13 的时候返回黑色，其他情况返回白色。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">getColorString</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>number <span class="token operator">===</span> <span class="token number">13</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'#000'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'#fff'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>假如现在需要传入 2 的时候返回 <code>#fafafa</code>，传入 3 的时候返回 <code>#f5f5f5</code>。你可能会继续扩展 <code>if ... else ...</code> 代码块，像下面这样。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">getColorString</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>number <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'#fafafa'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>number <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'#f5f5f5'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>number <span class="token operator">===</span> <span class="token number">13</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'#000'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'#fff'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>这也太没完没了了，长此以往将会有堆叠如山的 <code>if ... else ...</code> 块出现。我建议，当 <code>if ... else ...</code> 块达到 3 或以上的时候，就可以考虑使用 switch 了。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">getColorString</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>number<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">'#fafafa'</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">'#f5f5f5'</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">13</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">'#000'</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token string">'#fff'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>毫无疑问，继续添加 case 也会让 case 堆叠起来。在这个例子里，考虑使用 Array 来处理越来越多的 case 是一个更好的选择。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'#fff'</span><span class="token punctuation">,</span>
  <span class="token string">'#fafafa'</span><span class="token punctuation">,</span>
  <span class="token string">'#f5f5f5'</span><span class="token punctuation">,</span>
  <span class="token string">'#f0f0f0'</span><span class="token punctuation">,</span>
  <span class="token string">'#d9d9d9'</span><span class="token punctuation">,</span>
  <span class="token string">'#bfbfbf'</span><span class="token punctuation">,</span>
  <span class="token string">'#8c8c8c'</span><span class="token punctuation">,</span>
  <span class="token string">'#595959'</span><span class="token punctuation">,</span>
  <span class="token string">'#434343'</span><span class="token punctuation">,</span>
  <span class="token string">'#262626'</span><span class="token punctuation">,</span>
  <span class="token string">'#1f1f1f'</span><span class="token punctuation">,</span>
  <span class="token string">'#141414'</span><span class="token punctuation">,</span>
  <span class="token string">'#000'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">getColorString</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> colors<span class="token punctuation">[</span>number<span class="token punctuation">]</span> <span class="token operator">||</span> colors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>如果说要传入字符串，那么使用 Object 是一个更好的选择。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> colorObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'gray-1'</span><span class="token operator">:</span> <span class="token string">'#fff'</span><span class="token punctuation">,</span>
  <span class="token string">'gray-2'</span><span class="token operator">:</span> <span class="token string">'#fafafa'</span><span class="token punctuation">,</span>
  <span class="token string">'gray-3'</span><span class="token operator">:</span> <span class="token string">'#f5f5f5'</span><span class="token punctuation">,</span>
  <span class="token string">'gray-4'</span><span class="token operator">:</span> <span class="token string">'#f0f0f0'</span><span class="token punctuation">,</span>
  <span class="token string">'gray-5'</span><span class="token operator">:</span> <span class="token string">'#d9d9d9'</span><span class="token punctuation">,</span>
  <span class="token string">'gray-6'</span><span class="token operator">:</span> <span class="token string">'#bfbfbf'</span><span class="token punctuation">,</span>
  <span class="token string">'gray-7'</span><span class="token operator">:</span> <span class="token string">'#8c8c8c'</span><span class="token punctuation">,</span>
  <span class="token string">'gray-8'</span><span class="token operator">:</span> <span class="token string">'#595959'</span><span class="token punctuation">,</span>
  <span class="token string">'gray-9'</span><span class="token operator">:</span> <span class="token string">'#434343'</span><span class="token punctuation">,</span>
  <span class="token string">'gray-10'</span><span class="token operator">:</span> <span class="token string">'#262626'</span><span class="token punctuation">,</span>
  <span class="token string">'gray-11'</span><span class="token operator">:</span> <span class="token string">'#1f1f1f'</span><span class="token punctuation">,</span>
  <span class="token string">'gray-12'</span><span class="token operator">:</span> <span class="token string">'#141414'</span><span class="token punctuation">,</span>
  <span class="token string">'gray-13'</span><span class="token operator">:</span> <span class="token string">'#000'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">getColorString</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">colorName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> colorObject<span class="token punctuation">[</span>colorName<span class="token punctuation">]</span> <span class="token operator">||</span> colorObject<span class="token punctuation">[</span><span class="token string">'gray-1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>如果你熟悉 Map，使用 Map 也完全没有问题。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> colorMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">'gray-1'</span><span class="token punctuation">,</span> <span class="token string">'#fff'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'gray-2'</span><span class="token punctuation">,</span> <span class="token string">'#fafafa'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'gray-3'</span><span class="token punctuation">,</span> <span class="token string">'#f5f5f5'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'gray-4'</span><span class="token punctuation">,</span> <span class="token string">'#f0f0f0'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'gray-5'</span><span class="token punctuation">,</span> <span class="token string">'#d9d9d9'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'gray-6'</span><span class="token punctuation">,</span> <span class="token string">'#bfbfbf'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'gray-7'</span><span class="token punctuation">,</span> <span class="token string">'#8c8c8c'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'gray-8'</span><span class="token punctuation">,</span> <span class="token string">'#595959'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'gray-9'</span><span class="token punctuation">,</span> <span class="token string">'#434343'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'gray-10'</span><span class="token punctuation">,</span> <span class="token string">'#262626'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'gray-11'</span><span class="token punctuation">,</span> <span class="token string">'#1f1f1f'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'gray-12'</span><span class="token punctuation">,</span> <span class="token string">'#141414'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'gray-13'</span><span class="token punctuation">,</span> <span class="token string">'#000'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">getColorString</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">colorName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> colorMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>colorName<span class="token punctuation">)</span> <span class="token operator">||</span> colorMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'gray-1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>这么做的好处就是分离了数据源和操作，避免了不必要的堆叠，在改动时更加方便明确。</p> <p>如果使用了 <code>vue</code> 全家桶，结合计算属性也能写出类似的代码。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 一个传入颜色下标，显示对应颜色值的 vue 单文件组件 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{{ color }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> mapState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    index<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  computed<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 读取数组 colors，数据源是 this.$store.state.colors</span>
    <span class="token comment">// 我们只需要拿到 colors 就可以了，无需关心数据源内部如何运作</span>
    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function-variable function">colors</span><span class="token operator">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>colors<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 设置需要显示的颜色值，默认为 #fff</span>
    <span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>colors<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">'#fff'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="使用事件委托减少事件绑定"><a href="#使用事件委托减少事件绑定" class="header-anchor">#</a> 使用事件委托减少事件绑定</h2> <p>假如你有下面这么一段核心的 html 代码，需要监听所有 <code>li</code> 元素的点击事件。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>a<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>b<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>c<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>很自然地会出现一种想法，那就是直接监听每个 <code>li</code> 标签的点击事件。</p> <img src="/images/optimization/event-delegation-1.svg" alt="事件委托 1"> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 如果你不了解 document.querySelectorAll</span>
<span class="token comment">// 或许你需要再去学习一下 js 基础</span>
document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  element<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这种想法虽然直观，但性能比较差，因为它添加了 3 个监听事件。</p> <p>如果只监听 <code>li</code> 的父元素 <code>ul</code> 并根据 <code>event</code> 来判断，我们就省去了 2 个监听事件，消耗的浏览器资源也更少。</p> <img src="/images/optimization/event-delegation-2.svg" alt="事件委托 2"> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> target <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'li'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如果要为大量元素都绑定一个事件，不如在它们共同的父元素上绑定一个事件以做处理，这就是事件委托。它能有效地减少绑定的事件，减少浏览器使用的内存。</p> <h2 id="留意局部性-避免性能劣化"><a href="#留意局部性-避免性能劣化" class="header-anchor">#</a> 留意局部性，避免性能劣化</h2> <p>局部性原理 Locality 是操作系统里面的一个概念，指 CPU 访问存储器时访问的存储单元都趋于聚集在一个较小的连续区域内，这有利于提高访问速度。如果你不了解操作系统的概念，大可以直接跳到这部分的结尾看我给出的建议。</p> <p>由于 js 都运行在 js 引擎上，也就是专门处理 js 引擎的虚拟机上，虚拟机也类似于一个小型操作系统，所以局部性原理也可以迁移到 js 上。</p> <p>局部性有三种。</p> <ul><li>时间局部性 - 被访问一次的内存位置在短期内很可能被再次访问。</li> <li>空间局部性 - 未来访问的内存位置很可能和当前访问的内存位置相邻。</li> <li>顺序局部性 - 大部分指令是顺序进行的。</li></ul> <p>因为时间局部性和顺序局部性和引擎相关性较大，我们难以施加影响，所以我们重点关注一下空间局部性。</p> <p>不妨先考虑遍历一个较大的二维数组。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 构造一个数组</span>
<span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> j <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    element<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  array<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> sum<span class="token punctuation">;</span>
<span class="token keyword">let</span> timestamp<span class="token punctuation">;</span>

<span class="token comment">// 遍历方法 1</span>
timestamp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> row <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> row <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> row <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> col <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> col <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> col <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sum <span class="token operator">+=</span> array<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> timestamp<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 遍历方法 2</span>
timestamp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> col <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> col <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> col <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> row <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> row <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> row <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sum <span class="token operator">+=</span> array<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> timestamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>我们的重点不在 <code>sum</code> 的结果，而在两种方法的耗时。</p> <p>测试环境如下。</p> <table><tr><td>机型</td> <td>MacBook Pro (15-inch, 2018)</td></tr> <tr><td>系统</td> <td>macOS Big Sur 11.2</td></tr> <tr><td>处理器</td> <td>2.6 GHz 六核Intel Core i7</td></tr> <tr><td>内存</td> <td>16 GB 2400 MHz DDR4</td></tr> <tr><td>浏览器</td> <td>Microsoft Edge 88.0.705.68</td></tr></table> <p>遍历方法 1 的耗时在 0.98 秒左右波动，而遍历方法 2 的耗时在 3.85 秒左右波动，遍历方法 2 使用的时间几乎是遍历方法 1 的 4 倍。</p> <p>这和 js 引擎怎么处理数组这种引用类型有关。一般来说，js 引擎会把数组按行顺序存放在内存里，所以先访问同一行的数据（先访问 <code>array[0][0]</code> 再访问 <code>array[0][1]</code>）要比先访问同一列的数据（先访问 <code>array[0][0]</code> 再访问 <code>array[1][0]</code>）要快，在列数较多的情况下速度差距表现尤其明显。</p> <p>一个建议是，按照访问顺序来访问 Array 和 Object。</p> <p>访问 Array 可以使用 <code>Array.prototype.forEach</code> 或 <code>Array.prototype.entries</code>，也可以直接使用 <code>for</code> 和 <code>while</code> 遍历。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>array<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">element<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>index<span class="token punctuation">,</span> element<span class="token punctuation">]</span> <span class="token keyword">of</span> array<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> length <span class="token operator">=</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>而对象的访问顺序可以使用 <code>Object.keys</code> 获取，也可以使用 <code>Object.entries</code>。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
keys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> object<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> key<span class="token punctuation">]</span> <span class="token keyword">of</span> keys<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> object<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> length <span class="token operator">=</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> object<span class="token punctuation">[</span>keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="克制地操作-dom-减少重新渲染"><a href="#克制地操作-dom-减少重新渲染" class="header-anchor">#</a> 克制地操作 DOM，减少重新渲染</h2> <p>浏览器使用 HTML Parser（HTML 解析器）解析 HTML 文件，得到 DOM Tree（DOM 树，DOM 即 Document Object Model，文档对象模型）。</p> <p>对于 CSS 文件，浏览器使用 CSS Parser（CSS 解析器）解析，得到 Style Rules（也可以叫 CSSOM，CSS Object Model，层叠样式表对象模型）。</p> <p>之后，浏览器会结合 DOM Tree 和 Style Rules，生成 Render Tree（渲染树），它包含了所有节点的样式信息。</p> <p>浏览器生成布局 layout，再将布局绘制 paint，显示给用户查看。而生成布局和绘制这两步合称为渲染 render，耗时相当多。</p> <p>下面的图示囊括了以上的步骤。</p> <p><img src="http://www.ruanyifeng.com/blogimg/asset/2015/bg2015091502.png" alt="浏览器工作原理"></p> <p><a href="https://www.ruanyifeng.com/blog/2015/09/web-page-performance-in-depth.html" target="_blank" rel="noopener noreferrer">图源<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>渲染至少会进行一次，也就是打开网站的那一次。之后，如果进行了特定的操作，就会导致重新渲染 rerender，也就导致了重新生成布局（简称重排 reflow）和重新绘制（简称重绘 repaint）。</p> <p>需要明确的是，重绘不一定导致重排，但重排一定导致重绘。</p> <p>比如改变文字颜色，只会导致重绘，而改变文字位置就会导致重排和重绘。重排和重绘不能避免，但可以减少，只要减少重排和重绘，就能有效地提高网页性能。</p> <p>一个简单有效的建议就是，对 DOM 的读操作和写操作应尽量分开，读操作放在一起，写操作另外放在一起。这样能让浏览器把变动集中在一起统一处理，避免触发多次重排和重绘。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// bad</span>
div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'blue'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> marginTop <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>marginTop<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 浏览器被迫重新渲染</span>
div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>marginTop <span class="token operator">=</span> <span class="token punctuation">(</span>margin <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>

<span class="token comment">// good</span>
<span class="token keyword">const</span> offsetTop  <span class="token operator">=</span> div<span class="token punctuation">.</span>offsetTop<span class="token punctuation">;</span>
div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> top <span class="token operator">+</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'blue'</span><span class="token punctuation">;</span> <span class="token comment">// 浏览器统一处理</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>一般地，如果写操作后读取元素的位置相关信息，就会导致立即重新渲染。下面列写了读取元素的位置相关信息的属性或方法，我们应该尽量避免这种导致立即重新渲染的操作。</p> <table><tr><td><code>Element.offset{Top|Right|Bottom|Left}</code></td> <td><code>Element.scroll{Top|Right|Bottom|Left}</code></td></tr> <tr><td><code>Element.client{Top|Right|Bottom|Left}</code></td> <td><code>window.getComputedStyle</code></td></tr></table> <p>另一个行之有效的建议就是，尽量避免过多地直接操作非 <code>display: none</code> 的处于正常文档流的 DOM 元素。这个建议需要拆分成三个部分来阐述。</p> <p>首先是“直接操作”。直接操作可能会导致额外的重新渲染。你可以操作 <a href="https://developer.mozilla.org/en-US/docs/Web/API/DocumentFragment" target="_blank" rel="noopener noreferrer">DocumentFragment<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，操作完成后加入到 DOM 内；又或者克隆节点 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/cloneNode" target="_blank" rel="noopener noreferrer">Node.cloneNode<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 然后操作，最后用新节点替换原节点。</p> <p>第二个部分是“非 <code>display: none</code> 的元素”。<code>display: none</code> 的元素不会影响重新渲染，所以可以给一个需要多次操作的节点设置 <code>display: none</code>，操作完之后再让它正常显示，这样就可以只需要 2 次重新渲染。另外，<code>visibility: hidden</code> 的元素只影响重绘，不影响重排，这也是一个可利用的点。</p> <p>最后一个部分是“处于正常文档流的元素”。<code>position: absolute</code> 和 <code>position: fixed</code> 的元素就是脱离了正常文档流的元素，即便改变了它们，重排的开销也比较小，因为无需考虑该元素对其它元素的影响。</p> <p>现在 <code>vue</code> 和 <code>react</code> 内部都使用了 Virtual DOM，一般而言你无需操心 DOM 是如何读写的。但一旦脱离框架想要在原生上做更深入的优化，那就不得不提到手动调节重新渲染这个方法。</p> <p>某些时候无法避免密集的重新渲染，比如网页动画。网页动画的每一帧 frame 都是一次重新渲染，只有帧率达到 25 或以上，人眼才会感觉到比较流畅。</p> <p><img src="http://www.ruanyifeng.com/blogimg/asset/2015/bg2015091509.jpg" alt="帧率示意图"></p> <p><a href="https://www.ruanyifeng.com/blog/2015/09/web-page-performance-in-depth.html" target="_blank" rel="noopener noreferrer">图源<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>大多数显示器的刷新频率是 60Hz（1 秒刷新 60 次），所以网页动画达到 60Hz（1 秒 60 次重新渲染，每次重新渲染的时间不能超过 16.66 毫秒）就会和大多数显示器同步刷新，达到良好的视觉效果。由于浏览器计算重排、执行重绘也需要时间，所以留给我们的操作时间不足 16.66 毫秒。</p> <p><img src="http://www.ruanyifeng.com/blogimg/asset/2015/bg2015091511.png" alt="重新渲染示意图"></p> <p><a href="https://www.ruanyifeng.com/blog/2015/09/web-page-performance-in-depth.html" target="_blank" rel="noopener noreferrer">图源<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>一个解决方法是使用 web worker，跟 UI 渲染不相关的任务（比如处理数据）都放在 worker 线程，这样就不会干扰到主线程渲染 UI 了。限制就是，worker 内不能直接操作 DOM 节点，也不能使用 window 对象的默认方法和属性。</p> <p>另一个解决办法就是使用 <code>window.requestAnimationFrame</code>，它可以把一些代码放到下一次重新渲染时执行，类似的 API 还有 <code>window.requestIdleCallback</code>。</p> <p>由于我接触这方面相对较少，这里就不展开了。如果你感兴趣，不妨去查阅一下 API 说明，以及 react 团队为 concurrent mode 做出的工作。</p> <h2 id="鼓励更新-减少不必要兼容"><a href="#鼓励更新-减少不必要兼容" class="header-anchor">#</a> 鼓励更新，减少不必要兼容</h2> <p>前端已经发展了多年，已经有相当多的新特性新语法加入到浏览器的支持中。遗憾的是，为了兼容低版本的浏览器，比如 IE（大部分政企和高校计算机仍在使用），低版本 Android 和低版本 iOS，不得不加入各种 polyfill，甚至只能使用旧做法来做兼容。</p> <p>拿 <a href="https://caniuse.com" target="_blank" rel="noopener noreferrer">caniuse<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 上面的 flexbox 来举例。</p> <img src="/images/optimization/caniuse-flexbox.png" alt="caniuse-flexbox"> <p>可以看到，IE 全系列，Android 4.4 和 iOS 9 之前的版本对 flexbox 支持度不佳。如果我们需要适配这些版本，就需要加入 polyfill，甚至不能使用 flexbox（IE 6-9）。</p> <p>为了兼容而加入的 polyfill 浪费了服务器的空间，也浪费了访问用户的流量和时间（如果下载速度比较慢的话）。如果要兼容更古老的浏览器，还会浪费了开发人员过多的时间、精力。</p> <p>鼓励用户放弃旧版本的浏览器不仅是帮助开发人员，也是在帮助访问用户。如果有意放弃低版本浏览器和手机系统，不妨学习一下 YouTube 是怎么劝说用户放弃 IE 6 的。</p> <p>迫于现实压力，在低版本浏览器彻底退出历史舞台之前，我们仍然需要做兼容，但这不阻碍我们来看一下放弃兼容之后可行的做法，某些做法甚至已经投入到实践当中了。</p> <ul><li>图片使用 WebP/SVG/HEIF/AVIF 替代 BMP/JPG/PNG 等。</li> <li>图标使用 SVG 或图标字体替代 PNG。</li> <li>使用浏览器原生支持的 html 新标签，css 新特性（比如 flexbox/grid，可以替代 float），js 新语法和新特性（比如箭头函数，Map 和 Set）。</li> <li>...</li></ul> <h2 id="确定标签的位置-避免解析阻塞"><a href="#确定标签的位置-避免解析阻塞" class="header-anchor">#</a> 确定标签的位置，避免解析阻塞</h2> <p>下面是一个使用了 bootstrap 3 的 html 文件基本结构。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span>
      <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">integrity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>anonymous<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span>
      <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap-theme.min.css<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">integrity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sha384-6pzBo3FDv/PJ8r2KRkGHifhEocL+1X2rVCTTkUfGk7/0pbek5mMa1upzvWbrUbOZ<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>anonymous<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span>
      <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">integrity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>anonymous<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>可以看到，加载外链样式文件的标签放在了 html 文件头部，而加载外链脚本文件的标签放在了 html 文件尾部。这也是最常见的做法。</p> <p>首先需要明确一点，html 文件的解析是从上到下的。</p> <p>加载外链样式文件的标签放的位置，其实不影响 html 的解析，因为 css 的解析和 html 的解析会同步进行，但放的位置会影响渲染。</p> <p>如果把加载外链样式文件的标签放在 html 文件的尾部，浏览器就需要额外的时间解析样式文件。同时，浏览器会先渲染出一个没有外链样式的页面（会有行内样式），样式解析、加载完之后再重新渲染，这会耗费额外的时间，页面本身会闪烁，用户体验相当不好。</p> <p>而当浏览器解析到加载外链脚本文件的标签时，浏览器会立即下载执行，html 的解析就此暂停。如果下载执行的耗时过长，网页就会长时间没有响应，导致假死现象。</p> <p>所以，把加载外链样式文件的标签放在 html 文件头部，把加载外链脚本文件的标签放在 html 文件尾部，就成了最常见的做法。</p> <p>如果外链脚本文件内部没有操作 DOM，可以使用 <code>async</code> 或 <code>defer</code> 属性将它设置成异步加载。使用 <code>async</code> 属性的外链脚本文件一旦加载完成就会立即执行，而使用 <code>defer</code> 属性的会在 <code>DOMContentLoaded</code> 事件之前（也就是页面 DOM 加载完成时）执行。</p> <p>还需要注意的一点是，既然是异步加载，就无法确定哪个外链脚本文件的内容会被优先执行，这取决于下载完成的顺序。</p> <h2 id="合理构建-减少请求的时间"><a href="#合理构建-减少请求的时间" class="header-anchor">#</a> 合理构建，减少请求的时间</h2> <p>每一次请求资源都需要耗费一些时间。下面是我用 Microsoft Edge 88.0.705.6 打开百度的网络统计。</p> <img src="/images/optimization/edge-devtools-network.png" alt="edge-devtools-network"> <p>可以看到在禁止缓存的情况下，百度首页有 63 个请求，一共用了 7.63 秒才完成，<code>DOMContentLoaded</code> 只使用了 1.29 秒，速度已经相当不错了。</p> <p>点入计时，我们可以看到某一个请求的具体耗时信息。</p> <img src="/images/optimization/edge-devtools-network-timing-1.png" alt="edge-devtools-network-timing-1"> <ul><li>Queueing 表示在请求队列中等待的时间。</li> <li>Stalled 表示从连接建立完成到真正可以传输数据之间的时间差，包含了代理协商时间。</li> <li>Initial Connection（或 Connecting）表示建立连接所花费的时间，包括 TCP 握手，重试，协商 SSL 等耗时。</li> <li>SSL 表示完成 SSL 握手所耗费的时间。</li> <li>Request sent 表示发出网络请求所花费的时间。</li> <li>Waiting(TFFB) 表示等待发出页面请求到接收到应答数据第一个字节的时间。</li> <li>Content Download 表示接收响应数据所花费的时间。</li></ul> <p>此外，还有两个可能出现的说明。</p> <ul><li>Proxy negotiation 表示与代理服务器连接进行协商所花费的时间。</li> <li>DNS Lookup 表示执行 DNS 查找所花费的时间。</li></ul> <p>可以看到，这个请求里面请求和响应的时间是最长的，第二长的是连接相关的时间。但并非总是这样。</p> <p>下面是一个图片的请求。可以看到这一次，花费在连接上的时间更长，请求和响应的时间较短。</p> <img src="/images/optimization/edge-devtools-network-timing-2.png" alt="edge-devtools-network-timing-1"> <p>也因此，我们的构建配置要尽可能地优化这两点。</p> <p>一般资源都需要花费一部分时间在连接上。如果我们能合理地合并资源，减少请求的次数，就能实现有效优化。</p> <p>针对图片，以前会使用多张整合成一张的雪碧图，而现在一般会使用 <code>url-loader</code> 和 <code>file-loader</code> 把较小的图片内联到代码内，它们对其它的资产文件也一样有效。</p> <p>针对脚本文件，现在会使用 <code>webpack.optimization.splitChunks</code> 来划分，让用户先获取必要的资源来正常显示首页。</p> <p>除了合并资源外，压缩资源体积也是很好的解决的方法。分别使用 <code>html-webpack-plugin</code>，<code>cssnano</code> 和 <code>terser-webpack-plugin</code> 处理 html，css 和 js 文件，移除注释、空格等不影响正常运行的代码，达到压缩的目的。</p> <p>要进一步地压缩，不妨考虑 <code>compression-webpack-plugin</code>，它可以压缩文件得到体积更小的 gzip 文件。</p> <p>上面这些优化都是关于 <code>webpack</code> 的，你可以查看我的 <a href="/webpack4/">webpack4 示例</a> 进一步了解。</p> <p>除此之外，还可以使用 CDN 来访问某些包的已构建资源，CDN 往往拥有更快的请求和响应速度。问题在于 CDN 的稳定性并不由自己掌控，我自己更倾向于把 <code>splitChunks</code> 分离出的包部署在服务器上，不使用 CDN。</p> <p>框架的脚手架往往已经为我们准备好了合理的构建，我们无需操心太多，这也是为什么我更推荐使用脚手架直接开发。</p> <p>值得一提的是，相比于 <code>create-react-app</code>，<code>vue-cli</code> 有着特别的优化，那就是 <code>preload</code> 和 <code>prefetch</code>（使用了 <code>@vue/preload-webpack-plugin</code>）。</p> <p><code>&lt;link rel=&quot;preload&quot;&gt;</code> 是一种 resource hint，用来告诉浏览器页面加载后很快会被用到的资源，开始主体渲染之前尽早 preload。默认情况下，一个 <code>vue-cli</code> 创建的应用会为所有初始化渲染需要的文件自动生成 preload 提示。</p> <p><code>&lt;link rel=&quot;prefetch&quot;&gt;</code> 也是一种 resource hint，用来告诉浏览器在页面加载完成后，利用空闲时间提前获取用户未来可能会访问的内容。默认情况下，一个 <code>vue-cli</code> 应用会为所有作为 async chunk 生成的 js 文件自动生成 prefetch 提示。</p> <p>在非 <code>vue-cli</code> 初始化的项目里，你可以考虑手动添加这部分优化。</p> <h2 id="在合适的时候做合适的重构"><a href="#在合适的时候做合适的重构" class="header-anchor">#</a> 在合适的时候做合适的重构</h2> <p>在需求改动了一定次数之后，原本合理的代码架构可能会显得不是那么合理，跟进需求改动越来越困难。这往往是新需求与既往设计冲突而导致的。</p> <p>我一般倾向于在需求改动 50 次左右的时候做一次中小型的重构，而大型的重构难以简单地决定，一般由需求量，工作量，以及日期安排等因素综合决定。</p> <p>常见的优化手法有很多，比如封装重复代码，拆分函数功能，尽可能地使用预置 API 等。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// bad</span>
<span class="token keyword">function</span> <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">nickname<span class="token punctuation">,</span> password</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>password<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'密码长度不符合要求，请使用强密码'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> username <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>nickname<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        username <span class="token operator">+=</span> nickname<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'账号是'</span> <span class="token operator">+</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>上面一段代码试图处理提交事件，思路直观但相当糟糕。</p> <p>首先是在提交方法内部定义了怎么校验，导致函数本身不够单一。一种更好的做法是，分离校验和提交的定义，但可以在提交方法内部调用校验方法。分离后，无论是校验还是提交，都更易于扩展了。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// better</span>
<span class="token keyword">function</span> <span class="token function">handleValidate</span><span class="token punctuation">(</span><span class="token parameter">password</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>password<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'密码长度不符合要求，请使用强密码'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">nickname<span class="token punctuation">,</span> password</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">handleValidate</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> username <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>nickname<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        username <span class="token operator">+=</span> nickname<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'账号是'</span> <span class="token operator">+</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>另一个问题是，使用了 <code>for</code> 循环来获取 <code>nickname</code> 变量的前 8 位，并在不足 8 位时停止操作。使用预置的 <code>String.prototype.slice</code> 可以直接了当地完成这一步工作。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// even better</span>
<span class="token keyword">function</span> <span class="token function">handleValidate</span><span class="token punctuation">(</span><span class="token parameter">password</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>password<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'密码长度不符合要求，请使用强密码'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">nickname<span class="token punctuation">,</span> password</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">handleValidate</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> username <span class="token operator">=</span> nickname<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'账号是'</span> <span class="token operator">+</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>现在就更良好了。更多的重构手法你可以阅读 Martin Fowler 的《重构》一书。</p> <p>我在这里还想再强调一点，那就是选择合适的时间点去做重构。过早地重构会浪费宝贵的开发时间，过晚地重构会使重构工作难以开展，代码难以挽回。</p> <h2 id="使用-lighthouse-辅助分析"><a href="#使用-lighthouse-辅助分析" class="header-anchor">#</a> 使用 LightHouse 辅助分析</h2> <p><a href="https://github.com/GoogleChrome/lighthouse#readme" target="_blank" rel="noopener noreferrer">LightHouse<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是一个谷歌开源的网站性能分析工具，它可以分析任意网站的性能，打分并给出一些建议。</p> <p>你可以使用浏览器插件，也可以使用 cli。这里使用浏览器插件做演示。</p> <p>测试的对象依然是百度。LightHouse 生成了报告，我将它保存成 <a target="_blank" href="/documents/optimization/lighthouse-report-for-baidu.pdf">PDF</a> 供你在线查看。</p> <p>报告对问题的描述和给出的解决方案都相当详细，在这里就不再展开讲解报告了。</p> <h2 id="手动优化-vue"><a href="#手动优化-vue" class="header-anchor">#</a> 手动优化 vue</h2> <h3 id="函数式组件"><a href="#函数式组件" class="header-anchor">#</a> 函数式组件</h3> <p>函数式组件没有状态（也就是没有响应式数据），也没有实例（也就是没有 <code>this</code>），因此它的渲染开销也较少。</p> <p>函数式组件非常适合用于展示固定数据。</p> <h3 id="改善-seo"><a href="#改善-seo" class="header-anchor">#</a> 改善 SEO</h3> <p><code>vue-cli</code> 默认为我们构建一个对 SEO 不太友好的 SPA。如果需要良好的 SEO，我们不得不考虑一些方案。</p> <p>如果只是想改善少量页面（<code>/</code>，<code>/about</code>，<code>/contact</code> 等）的 SEO，使用预渲染 prerender 即可（<a href="https://github.com/chrisvfritz/prerender-spa-plugin#readme" target="_blank" rel="noopener noreferrer">prerender-spa-plugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）。预渲染可以在构建时 build time 生成针对特定路由的静态网页，甚至可以将网站完全静态化。</p> <p>在其它的情况下，你可能更需要服务端渲染 SSR。其具体的优劣和配置指南可以直接查看 <a href="https://ssr.vuejs.org/zh/" target="_blank" rel="noopener noreferrer">Vue SSR 指南<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>除了手动配置 SSR 之外，直接使用 <a href="https://nuxtjs.org/" target="_blank" rel="noopener noreferrer">Nuxt<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 或 <a href="https://quasar.dev/" target="_blank" rel="noopener noreferrer">Quasar<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 也是一个很好的选择。</p> <p>由于我接触这方面相对较少，这里就不展开了。</p> <h3 id="异步加载非首页路由"><a href="#异步加载非首页路由" class="header-anchor">#</a> 异步加载非首页路由</h3> <p>正如我在<a href="#%E5%90%88%E7%90%86%E6%9E%84%E5%BB%BA%E5%87%8F%E5%B0%91%E8%AF%B7%E6%B1%82%E7%9A%84%E6%97%B6%E9%97%B4">合理构建，减少请求的时间</a>里提到的一样，<code>vue-cli</code> 会内置 preload 和 prefetch 的优化。</p> <p>下面是一个简单的配置例子。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> Index <span class="token keyword">from</span> <span class="token string">'@/views/index.vue'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  routes<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">'index'</span><span class="token punctuation">,</span>
      component<span class="token operator">:</span> Index<span class="token punctuation">,</span> <span class="token comment">// preload</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      path<span class="token operator">:</span> <span class="token string">'/about'</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">'about'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/about.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// prefetch</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><code>vue-cli</code> 会自动处理资源，为同步引入的资源添加 preload，为异步引入的资源添加 prefetch。</p> <p>一般来说，可以被直接访问的页面（比如首页，关于页）需要 preload，其它页面只需要 prefetch。</p> <h3 id="合理使用-vuex"><a href="#合理使用-vuex" class="header-anchor">#</a> 合理使用 vuex</h3> <p>在实际开发中往往会遇到多个组件需要反映相同的变化数据的情况，这时最好将共享状态提升到最近的共同父组件中去。当共同的父组件与它们跨越的层级较多，这时候更推荐使用全局状态管理。</p> <p>关于状态管理模式，可以直接查看 <a href="https://vuex.vuejs.org/zh/" target="_blank" rel="noopener noreferrer">Vuex 是什么<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。这里只想先讨论如何划分模块的问题。</p> <p>如何划分模块，甚至要不要划分模块，一直没有定论。一派更倾向于不使用 <code>vuex</code> 模块，可以像 <code>redux</code> 一样使用 <code>vuex</code>。我个人属于另一派，更则倾向于使用 <code>vuex</code> 模块，并为每个模块都开启命名空间。</p> <p>我会把 <code>vuex</code> 模块分成两类，一类是应用使用的模块，另一类是业务使用的模块。应用使用的模块往往命名为 <code>app</code>，里面保存用户设置的语言、主题等数据；业务使用的模块命名视具体情况而定，里面保存用户信息和业务相关等数据。</p> <img src="/images/optimization/vuex-modules.svg" alt="vuex-modules"> <p>这么做的好处是明确划分了界限，强调模块化。坏处就是业务本身比较错综复杂时，非常考究开发者划分模块的功底。一旦划分的模块被业务需求模糊了界限，划分模块就会显得多余且累赘。</p> <p>而模块下的数据则应该尽量扁平化，模块下不应该再嵌套模块，这样能有效地避免过长的链式调用。</p> <h2 id="手动优化-react"><a href="#手动优化-react" class="header-anchor">#</a> 手动优化 react</h2> <p>TODO</p> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li>David Thomas, Andrew Hunt - 程序员修炼之道</li> <li>Martin Fowler - 重构</li> <li><a href="https://developers.google.cn/web/tools/chrome-devtools" target="_blank" rel="noopener noreferrer">chrome devtools<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Tools" target="_blank" rel="noopener noreferrer">firefox devtools<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.microsoft.com/en-us/microsoft-edge/devtools-guide-chromium" target="_blank" rel="noopener noreferrer">edge(chromium devtools<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://woai3c.github.io/introduction-to-front-end-engineering/" target="_blank" rel="noopener noreferrer">谭光志 - 带你入门前端工程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://segmentfault.com/a/1190000002789651" target="_blank" rel="noopener noreferrer">[ JS 进阶 ] 基本类型 引用类型 简单赋值 对象引用<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.ruanyifeng.com/blog/2015/09/web-page-performance-in-depth.html" target="_blank" rel="noopener noreferrer">阮一峰 - 网页性能管理详解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.cnblogs.com/WindrunnerMax/p/13972793.html" target="_blank" rel="noopener noreferrer">WindrunnerMax - Vue 常用性能优化<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://ssr.vuejs.org/zh/" target="_blank" rel="noopener noreferrer">Vue.js 服务端渲染指南<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/GoogleChrome/lighthouse#readme" target="_blank" rel="noopener noreferrer">LightHouse<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/6844904016325902344" target="_blank" rel="noopener noreferrer">小维 FE - 一文搞懂 V8 引擎的垃圾回收<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="致谢"><a href="#致谢" class="header-anchor">#</a> 致谢</h2> <ul><li><a href="https://github.com/XuXianTao" target="_blank" rel="noopener noreferrer">XuXianTao<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - 阅读了初稿并提供了弥足珍贵的建议和意见</li></ul></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/ModyQyW/modyqyw.github.io/edit/origin/optimization/README.md" target="_blank" rel="noopener noreferrer">编辑此页</a></div> <div class="meta-item update-time"><span class="label">上次编辑于:</span> <span class="info">2021年7月5日 05:18</span></div> <!----></footer> <!----> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="关闭" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">该应用可以安装在您的 PC 或移动设备上。这将使该 Web 应用程序外观和行为与其他应用程序相同。它将在出现在应用程序列表中，并可以固定到主屏幕，开始菜单或任务栏。此 Web 应用程序还将能够与其他应用程序和您的操作系统安全地进行交互。</p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>详情</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        安装 <span></span></button> <button class="cancel-button">
        取消
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close"></button> <button class="pswp__button pswp__button--share"></button> <button class="pswp__button pswp__button--fs"></button> <button class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left"></button> <button class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:65px;bottom:0px;width:135px;height:300px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div></div></div>
    <script src="/assets/js/app.97090625.js" defer></script><script src="/assets/js/vendors~layout-Layout.2575cae3.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.98c9c1a5.js" defer></script><script src="/assets/js/page-优化.4906bffb.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.ec478e91.js" defer></script>
  </body>
</html>
