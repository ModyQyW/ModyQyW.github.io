# 安全

## 说明

- 状态：目前处于书写中状态，可能会存在错误或瑕疵，缺少部分图片说明，不建议阅读这个阶段的文本。

## 从 HTTP 到 HTTPS

### HTTP

在信息安全逐步受到重视的大前提下，人们重新审视了 HTTP 协议。

#### HTTP 通信使用明文

基于 TCP/IP 的 HTTP 本身没有加密的功能，所以**没有办法加密通信通道**，这是 HTTP 通信使用明文的核心痛点。

要看到通信内容非常容易，你完全可以用 wireshark，fiddler，charles 之类的工具来查看 HTTP 报文。

而为了防止被窃听，我们**引入了加密技术**。当然，我们现在知道被广泛使用的就是 HTTPS（HTTP Secure，超文本传输安全协议），我们现在可以简单地认为 **HTTPS = HTTP + SSL（Secure Socket Layer，安全套接层）/TLS（Transport Layer Security，安全层传输协议）**。HTTPS 组合使用 HTTP 和 SSL/TLS，加密了通信通道，使得别人无法窃听通信内容，达到了安全的目的。

如果我们不加密通信通道，我们也可以加密通信内容。但这么做，别人仍然能窃听加密后的通信内容，进而仍然有被篡改的风险。

#### HTTP 协议没有验证通信方的身份

HTTP 不会确认通信方的请求/响应，也就是说**任何人都能发出请求/响应**，这也就带来了一系列问题。

比较常见的隐患有这么几个：

- 没有办法确认服务器是不是目标服务器，有可能是恶意服务器。
- 没有办法确认客户端是不是目标客户端，有可能是恶意客户端。
- 没有办法确认客户端是不是有权限访问特定的内容。
- 没有办法阻止海量请求下的 DoS（Denial of Service，拒绝服务）攻击。

SSL 提供了**证书**这种手段来确认身份。一般来说，证书由值得信赖的第三方机构颁发，它非常难以伪造，用于确认身份。所以，只要确认证书，就可以确认持有证书的所有者身份。

#### HTTP 协议不能证明报文完整正确

HTTP 没有办法确认发出的请求/响应和收到的请求/响应是相同的，所以请求/响应可能会在中途被他人拦截并修改，这也就是中间人攻击（Man-in-the-Middle Attack，MITM）。

可以使用 MD5/SHA-1 等散列值校验的方法、PGP 等数字签名方法来确定完整性，但是需要用户亲自验证，并不便捷，另外也存在 PGP/MD5/... 本身被改写的极端情况，并不安全。

SSL 提供了**认证和加密处理及摘要**功能，有效地解决了这个问题。

### HTTPS

组合使用 HTTP 和通信加密、证书、完整性保护等机制，我们就得到了 HTTPS。

需要再次强调的是，HTTPS 不是应用层的新协议，只是用 SSL/TLS 代替了 HTTP 通信接口部分而已。使用 HTTP 时，HTTP 直接和 TCP/IP 通信。而使用 HTTPS 时，HTTPS 先和 SSL/TLS 通信，再由 SSL/TLS 和 TCP/IP 通信。所以我们上面提到，可以简单地认为 **HTTPS = HTTP + SSL/TLS**。

#### 对称加密和非对称加密

SSL 使用到了非对称加密，这是一种比对称加密更稳妥的加密方式。

对称加密是加解密共用一个密钥的加密方式，算法公开、计算量小、加密速度快、加密效率高。对称加密的问题在于：

- 发送的过程中密钥有可能会被他人窃听，进而丧失加密的意义，但不发送密钥的话对方又无法解密信息。
- 保留密钥需要考虑安全问题。
- 更进一步地说，如果密钥能够安全地发出，那信息也应该能安全地发出，那加密还有什么必要呢？

非对称加密解决了对称加密的几个问题。非对称加密使用了两个密钥：

- 一个称为私钥，请求方自己保留，用于解密响应方返回的已加密的响应信息。
- 另一个称为公钥，请求方公开，响应方用公钥加密响应信息再返回。

这么做就无需担心密钥被窃听进而被用于破解信息，因为发出的密钥只是公钥，而使用公钥成功解密信息的可能性微乎其微，解密成本大大提高，通信双方只需互换公钥就可以实现相对意义上的安全通信。

非对称加密最大的缺点就是处理速度慢，所以从安全和速度两方面考虑，HTTPS 采用了混合加密机制。

#### 混合加密机制

HTTPS 首先会使用非对称加密方式确定共用密钥，然后在通信过程中使用共用密钥进行对称加密。

由于共用密钥被非对称加密后再进行传输，所以即使被人窃听，也难以解密出共用密钥，后续过程再使用共用密钥加密信息、发送信息就相对而言是安全的。

#### 数字签名与证书

### TLS 1.2

### TLS 1.3

### 优化 HTTPS

## XSS

## SQL 注入

## CSRF/SSRF

## 文件上传漏洞

## 参考

- 上野宣 - 图解 HTTP

待补充，催稿可以

（1）邮件催稿

（2）打赏，备注“催稿+内容”（通常这种方式会更有效点，毕竟收了钱不好意思再拖，打了钱就不要再打啦，我会加油写的）

<Vssue />
